{"ast":null,"code":"import React,{useContext,useEffect,useReducer,useState}from\"react\";import{Link as RouterLink,useHistory}from\"react-router-dom\";import ListItem from\"@material-ui/core/ListItem\";import ListItemIcon from\"@material-ui/core/ListItemIcon\";import ListItemText from\"@material-ui/core/ListItemText\";import ListSubheader from\"@material-ui/core/ListSubheader\";import Divider from\"@material-ui/core/Divider\";import{Badge,Collapse,List}from\"@material-ui/core\";import DashboardOutlinedIcon from\"@material-ui/icons/DashboardOutlined\";import WhatsAppIcon from\"@material-ui/icons/WhatsApp\";import SyncAltIcon from\"@material-ui/icons/SyncAlt\";import SettingsOutlinedIcon from\"@material-ui/icons/SettingsOutlined\";import PeopleAltOutlinedIcon from\"@material-ui/icons/PeopleAltOutlined\";import ContactPhoneOutlinedIcon from\"@material-ui/icons/ContactPhoneOutlined\";import AccountTreeOutlinedIcon from\"@material-ui/icons/AccountTreeOutlined\";import FlashOnIcon from\"@material-ui/icons/FlashOn\";import HelpOutlineIcon from\"@material-ui/icons/HelpOutline\";import CodeRoundedIcon from\"@material-ui/icons/CodeRounded\";import EventIcon from\"@material-ui/icons/Event\";import LocalOfferIcon from\"@material-ui/icons/LocalOffer\";import EventAvailableIcon from\"@material-ui/icons/EventAvailable\";import ExpandLessIcon from\"@material-ui/icons/ExpandLess\";import ExpandMoreIcon from\"@material-ui/icons/ExpandMore\";import PeopleIcon from\"@material-ui/icons/People\";import ListIcon from\"@material-ui/icons/ListAlt\";import AnnouncementIcon from\"@material-ui/icons/Announcement\";import ForumIcon from\"@material-ui/icons/Forum\";import LocalAtmIcon from'@material-ui/icons/LocalAtm';import PaymentIcon from\"@material-ui/icons/Payment\";import TableChartIcon from'@material-ui/icons/TableChart';import{i18n}from\"../translate/i18n\";import{WhatsAppsContext}from\"../context/WhatsApp/WhatsAppsContext\";import{AuthContext}from\"../context/Auth/AuthContext\";import{Can}from\"../components/Can\";import{socketConnection}from\"../services/socket\";import{isArray}from\"lodash\";import api from\"../services/api\";import toastError from\"../errors/toastError\";import useVersion from\"../hooks/useVersion\";//PLW DESIGN BY SANTOS //\nimport Typography from\"@material-ui/core/Typography\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function ListItemLink(props){const{icon,primary,to,className}=props;const renderLink=React.useMemo(()=>/*#__PURE__*/React.forwardRef((itemProps,ref)=>/*#__PURE__*/_jsx(RouterLink,{to:to,ref:ref,...itemProps})),[to]);return/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(ListItem,{button:true,component:renderLink,className:className,children:[icon?/*#__PURE__*/_jsx(ListItemIcon,{children:icon}):null,/*#__PURE__*/_jsx(ListItemText,{primary:primary})]})});}const reducer=(state,action)=>{if(action.type===\"LOAD_CHATS\"){const chats=action.payload;const newChats=[];if(isArray(chats)){chats.forEach(chat=>{const chatIndex=state.findIndex(u=>u.id===chat.id);if(chatIndex!==-1){state[chatIndex]=chat;}else{newChats.push(chat);}});}return[...state,...newChats];}if(action.type===\"UPDATE_CHATS\"){const chat=action.payload;const chatIndex=state.findIndex(u=>u.id===chat.id);if(chatIndex!==-1){state[chatIndex]=chat;return[...state];}else{return[chat,...state];}}if(action.type===\"DELETE_CHAT\"){const chatId=action.payload;const chatIndex=state.findIndex(u=>u.id===chatId);if(chatIndex!==-1){state.splice(chatIndex,1);}return[...state];}if(action.type===\"RESET\"){return[];}if(action.type===\"CHANGE_CHAT\"){const changedChats=state.map(chat=>{if(chat.id===action.payload.chat.id){return action.payload.chat;}return chat;});return changedChats;}};const MainListItems=(props,_ref)=>{let{collapsed}=_ref;const{drawerClose}=props;const{whatsApps}=useContext(WhatsAppsContext);const{user}=useContext(AuthContext);const[connectionWarning,setConnectionWarning]=useState(false);const[openCampaignSubmenu,setOpenCampaignSubmenu]=useState(false);const[showCampaigns,setShowCampaigns]=useState(false);const history=useHistory();//CÃ“DIGO EDITADO//\nconst[version,setVersion]=useState(false);const[invisible,setInvisible]=useState(true);const[pageNumber,setPageNumber]=useState(1);const[searchParam]=useState(\"\");const[chats,dispatch]=useReducer(reducer,[]);const{getVersion}=useVersion();useEffect(()=>{dispatch({type:\"RESET\"});setPageNumber(1);},[searchParam]);//EDITADO POR SANTOS//\nuseEffect(()=>{async function fetchVersion(){const _version=await getVersion();setVersion(_version.version);}fetchVersion();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);//EDITADO POR SANTOS//\nuseEffect(()=>{const delayDebounceFn=setTimeout(()=>{fetchChats();},500);return()=>clearTimeout(delayDebounceFn);// eslint-disable-next-line react-hooks/exhaustive-deps\n},[searchParam,pageNumber]);useEffect(()=>{const companyId=localStorage.getItem(\"companyId\");const socket=socketConnection({companyId});socket.on(\"company-\".concat(companyId,\"-chat\"),data=>{if(data.action===\"new-message\"){dispatch({type:\"CHANGE_CHAT\",payload:data});}if(data.action===\"update\"){dispatch({type:\"CHANGE_CHAT\",payload:data});}});return()=>{socket.disconnect();};},[]);useEffect(()=>{let unreadsCount=0;if(chats.length>0){for(let chat of chats){for(let chatUser of chat.users){if(chatUser.userId===user.id){unreadsCount+=chatUser.unreads;}}}}if(unreadsCount>0){setInvisible(false);}else{setInvisible(true);}},[chats,user.id]);useEffect(()=>{if(localStorage.getItem(\"cshow\")){setShowCampaigns(true);}},[]);useEffect(()=>{const delayDebounceFn=setTimeout(()=>{if(whatsApps.length>0){const offlineWhats=whatsApps.filter(whats=>{return whats.status===\"qrcode\"||whats.status===\"PAIRING\"||whats.status===\"DISCONNECTED\"||whats.status===\"TIMEOUT\"||whats.status===\"OPENING\";});if(offlineWhats.length>0){setConnectionWarning(true);}else{setConnectionWarning(false);}}},2000);return()=>clearTimeout(delayDebounceFn);},[whatsApps]);const fetchChats=async()=>{try{const{data}=await api.get(\"/chats/\",{params:{searchParam,pageNumber}});dispatch({type:\"LOAD_CHATS\",payload:data.records});}catch(err){toastError(err);}};return/*#__PURE__*/_jsxs(\"div\",{onClick:drawerClose,children:[/*#__PURE__*/_jsx(Can,{role:user.profile,perform:\"dashboard:view\",yes:()=>/*#__PURE__*/_jsx(ListItemLink,{to:\"/\",primary:\"Dashboard\",icon:/*#__PURE__*/_jsx(DashboardOutlinedIcon,{})})}),/*#__PURE__*/_jsx(ListItemLink,{to:\"/tickets\",primary:i18n.t(\"mainDrawer.listItems.tickets\"),icon:/*#__PURE__*/_jsx(WhatsAppIcon,{})}),/*#__PURE__*/_jsx(ListItemLink,{to:\"/kanban\",primary:i18n.t(\"Kanban\"),icon:/*#__PURE__*/_jsx(TableChartIcon,{})}),/*#__PURE__*/_jsx(ListItemLink,{to:\"/quick-messages\",primary:i18n.t(\"mainDrawer.listItems.quickMessages\"),icon:/*#__PURE__*/_jsx(FlashOnIcon,{})}),/*#__PURE__*/_jsx(ListItemLink,{to:\"/contacts\",primary:i18n.t(\"mainDrawer.listItems.contacts\"),icon:/*#__PURE__*/_jsx(ContactPhoneOutlinedIcon,{})}),/*#__PURE__*/_jsx(ListItemLink,{to:\"/schedules\",primary:i18n.t(\"mainDrawer.listItems.schedules\"),icon:/*#__PURE__*/_jsx(EventIcon,{})}),/*#__PURE__*/_jsx(ListItemLink,{to:\"/tags\",primary:i18n.t(\"mainDrawer.listItems.tags\"),icon:/*#__PURE__*/_jsx(LocalOfferIcon,{})}),/*#__PURE__*/_jsx(ListItemLink,{to:\"/chats\",primary:i18n.t(\"mainDrawer.listItems.chats\"),icon:/*#__PURE__*/_jsx(Badge,{color:\"secondary\",variant:\"dot\",invisible:invisible,children:/*#__PURE__*/_jsx(ForumIcon,{})})}),/*#__PURE__*/_jsx(ListItemLink,{to:\"/helps\",primary:i18n.t(\"mainDrawer.listItems.helps\"),icon:/*#__PURE__*/_jsx(HelpOutlineIcon,{})}),/*#__PURE__*/_jsx(Can,{role:user.profile,perform:\"drawer-admin-items:view\",yes:()=>/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(ListSubheader,{inset:true,children:i18n.t(\"mainDrawer.listItems.administration\")}),showCampaigns&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(ListItem,{button:true,onClick:()=>setOpenCampaignSubmenu(prev=>!prev),children:[/*#__PURE__*/_jsx(ListItemIcon,{children:/*#__PURE__*/_jsx(EventAvailableIcon,{})}),/*#__PURE__*/_jsx(ListItemText,{primary:i18n.t(\"mainDrawer.listItems.campaigns\")}),openCampaignSubmenu?/*#__PURE__*/_jsx(ExpandLessIcon,{}):/*#__PURE__*/_jsx(ExpandMoreIcon,{})]}),/*#__PURE__*/_jsx(Collapse,{style:{paddingLeft:15},in:openCampaignSubmenu,timeout:\"auto\",unmountOnExit:true,children:/*#__PURE__*/_jsxs(List,{component:\"div\",disablePadding:true,children:[/*#__PURE__*/_jsxs(ListItem,{onClick:()=>history.push(\"/campaigns\"),button:true,children:[/*#__PURE__*/_jsx(ListItemIcon,{children:/*#__PURE__*/_jsx(ListIcon,{})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"Listagem\"})]}),/*#__PURE__*/_jsxs(ListItem,{onClick:()=>history.push(\"/contact-lists\"),button:true,children:[/*#__PURE__*/_jsx(ListItemIcon,{children:/*#__PURE__*/_jsx(PeopleIcon,{})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"Listas de Contatos\"})]}),/*#__PURE__*/_jsxs(ListItem,{onClick:()=>history.push(\"/campaigns-config\"),button:true,children:[/*#__PURE__*/_jsx(ListItemIcon,{children:/*#__PURE__*/_jsx(SettingsOutlinedIcon,{})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"Configura\\xE7\\xF5es\"})]})]})})]}),user.super&&/*#__PURE__*/_jsx(ListItemLink,{to:\"/announcements\",primary:i18n.t(\"mainDrawer.listItems.annoucements\"),icon:/*#__PURE__*/_jsx(AnnouncementIcon,{})}),/*#__PURE__*/_jsx(ListItemLink,{to:\"/connections\",primary:i18n.t(\"mainDrawer.listItems.connections\"),icon:/*#__PURE__*/_jsx(Badge,{badgeContent:connectionWarning?\"!\":0,color:\"error\",children:/*#__PURE__*/_jsx(SyncAltIcon,{})})}),/*#__PURE__*/_jsx(ListItemLink,{to:\"/queues\",primary:i18n.t(\"mainDrawer.listItems.queues\"),icon:/*#__PURE__*/_jsx(AccountTreeOutlinedIcon,{})}),/*#__PURE__*/_jsx(ListItemLink,{to:\"/users\",primary:i18n.t(\"mainDrawer.listItems.users\"),icon:/*#__PURE__*/_jsx(PeopleAltOutlinedIcon,{})}),/*#__PURE__*/_jsx(ListItemLink,{to:\"/financeiro\",primary:i18n.t(\"mainDrawer.listItems.financeiro\"),icon:/*#__PURE__*/_jsx(LocalAtmIcon,{})}),/*#__PURE__*/_jsx(ListItemLink,{to:\"/settings\",primary:i18n.t(\"mainDrawer.listItems.settings\"),icon:/*#__PURE__*/_jsx(SettingsOutlinedIcon,{})}),!collapsed&&/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsxs(Typography,{style:{fontSize:\"12px\",padding:\"10px\",textAlign:\"right\",fontWeight:\"bold\"},children:[\"Vers\\xE3o: \",version]})]})]})})]});};export default MainListItems;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}