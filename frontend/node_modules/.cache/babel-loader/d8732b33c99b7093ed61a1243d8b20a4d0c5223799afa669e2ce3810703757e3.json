{"ast":null,"code":"import React,{useState,useEffect,useReducer}from\"react\";import{toast}from\"react-toastify\";import{useHistory}from\"react-router-dom\";import{makeStyles}from\"@material-ui/core/styles\";import Paper from\"@material-ui/core/Paper\";import Button from\"@material-ui/core/Button\";import Table from\"@material-ui/core/Table\";import TableBody from\"@material-ui/core/TableBody\";import TableCell from\"@material-ui/core/TableCell\";import TableHead from\"@material-ui/core/TableHead\";import TableRow from\"@material-ui/core/TableRow\";import IconButton from\"@material-ui/core/IconButton\";import SearchIcon from\"@material-ui/icons/Search\";import TextField from\"@material-ui/core/TextField\";import InputAdornment from\"@material-ui/core/InputAdornment\";import DeleteOutlineIcon from\"@material-ui/icons/DeleteOutline\";import EditIcon from\"@material-ui/icons/Edit\";import PeopleIcon from\"@material-ui/icons/People\";import DownloadIcon from\"@material-ui/icons/GetApp\";import MainContainer from\"../../components/MainContainer\";import MainHeader from\"../../components/MainHeader\";import Title from\"../../components/Title\";import api from\"../../services/api\";import{i18n}from\"../../translate/i18n\";import TableRowSkeleton from\"../../components/TableRowSkeleton\";import ContactListDialog from\"../../components/ContactListDialog\";import ConfirmationModal from\"../../components/ConfirmationModal\";import toastError from\"../../errors/toastError\";import{Grid}from\"@material-ui/core\";import planilhaExemplo from\"../../assets/planilha.xlsx\";import{socketConnection}from\"../../services/socket\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const reducer=(state,action)=>{if(action.type===\"LOAD_CONTACTLISTS\"){const contactLists=action.payload;const newContactLists=[];contactLists.forEach(contactList=>{const contactListIndex=state.findIndex(u=>u.id===contactList.id);if(contactListIndex!==-1){state[contactListIndex]=contactList;}else{newContactLists.push(contactList);}});return[...state,...newContactLists];}if(action.type===\"UPDATE_CONTACTLIST\"){const contactList=action.payload;const contactListIndex=state.findIndex(u=>u.id===contactList.id);if(contactListIndex!==-1){state[contactListIndex]=contactList;return[...state];}else{return[contactList,...state];}}if(action.type===\"DELETE_CONTACTLIST\"){const contactListId=action.payload;const contactListIndex=state.findIndex(u=>u.id===contactListId);if(contactListIndex!==-1){state.splice(contactListIndex,1);}return[...state];}if(action.type===\"RESET\"){return[];}};const useStyles=makeStyles(theme=>({mainPaper:{flex:1,padding:theme.spacing(1),overflowY:\"scroll\",...theme.scrollbarStyles}}));const ContactLists=()=>{const classes=useStyles();const history=useHistory();const[loading,setLoading]=useState(false);const[pageNumber,setPageNumber]=useState(1);const[hasMore,setHasMore]=useState(false);const[selectedContactList,setSelectedContactList]=useState(null);const[deletingContactList,setDeletingContactList]=useState(null);const[contactListModalOpen,setContactListModalOpen]=useState(false);const[confirmModalOpen,setConfirmModalOpen]=useState(false);const[searchParam,setSearchParam]=useState(\"\");const[contactLists,dispatch]=useReducer(reducer,[]);useEffect(()=>{dispatch({type:\"RESET\"});setPageNumber(1);},[searchParam]);useEffect(()=>{setLoading(true);const delayDebounceFn=setTimeout(()=>{const fetchContactLists=async()=>{try{const{data}=await api.get(\"/contact-lists/\",{params:{searchParam,pageNumber}});dispatch({type:\"LOAD_CONTACTLISTS\",payload:data.records});setHasMore(data.hasMore);setLoading(false);}catch(err){toastError(err);}};fetchContactLists();},500);return()=>clearTimeout(delayDebounceFn);},[searchParam,pageNumber]);useEffect(()=>{const companyId=localStorage.getItem(\"companyId\");const socket=socketConnection({companyId});socket.on(\"company-\".concat(companyId,\"-ContactList\"),data=>{if(data.action===\"update\"||data.action===\"create\"){dispatch({type:\"UPDATE_CONTACTLIST\",payload:data.record});}if(data.action===\"delete\"){dispatch({type:\"DELETE_CONTACTLIST\",payload:+data.id});}});return()=>{socket.disconnect();};},[]);const handleOpenContactListModal=()=>{setSelectedContactList(null);setContactListModalOpen(true);};const handleCloseContactListModal=()=>{setSelectedContactList(null);setContactListModalOpen(false);};const handleSearch=event=>{setSearchParam(event.target.value.toLowerCase());};const handleEditContactList=contactList=>{setSelectedContactList(contactList);setContactListModalOpen(true);};const handleDeleteContactList=async contactListId=>{try{await api.delete(\"/contact-lists/\".concat(contactListId));toast.success(i18n.t(\"contactLists.toasts.deleted\"));}catch(err){toastError(err);}setDeletingContactList(null);setSearchParam(\"\");setPageNumber(1);};const loadMore=()=>{setPageNumber(prevState=>prevState+1);};const handleScroll=e=>{if(!hasMore||loading)return;const{scrollTop,scrollHeight,clientHeight}=e.currentTarget;if(scrollHeight-(scrollTop+100)<clientHeight){loadMore();}};const goToContacts=id=>{history.push(\"/contact-lists/\".concat(id,\"/contacts\"));};return/*#__PURE__*/_jsxs(MainContainer,{children:[/*#__PURE__*/_jsx(ConfirmationModal,{title:deletingContactList&&\"\".concat(i18n.t(\"contactLists.confirmationModal.deleteTitle\"),\" \").concat(deletingContactList.name,\"?\"),open:confirmModalOpen,onClose:setConfirmModalOpen,onConfirm:()=>handleDeleteContactList(deletingContactList.id),children:i18n.t(\"contactLists.confirmationModal.deleteMessage\")}),/*#__PURE__*/_jsx(ContactListDialog,{open:contactListModalOpen,onClose:handleCloseContactListModal,\"aria-labelledby\":\"form-dialog-title\",contactListId:selectedContactList&&selectedContactList.id}),/*#__PURE__*/_jsx(MainHeader,{children:/*#__PURE__*/_jsxs(Grid,{style:{width:\"99.6%\"},container:true,children:[/*#__PURE__*/_jsx(Grid,{xs:12,sm:8,item:true,children:/*#__PURE__*/_jsx(Title,{children:i18n.t(\"contactLists.title\")})}),/*#__PURE__*/_jsx(Grid,{xs:12,sm:4,item:true,children:/*#__PURE__*/_jsxs(Grid,{spacing:2,container:true,children:[/*#__PURE__*/_jsx(Grid,{xs:7,sm:6,item:true,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,placeholder:i18n.t(\"contacts.searchPlaceholder\"),type:\"search\",value:searchParam,onChange:handleSearch,InputProps:{startAdornment:/*#__PURE__*/_jsx(InputAdornment,{position:\"start\",children:/*#__PURE__*/_jsx(SearchIcon,{style:{color:\"gray\"}})})}})}),/*#__PURE__*/_jsx(Grid,{xs:5,sm:6,item:true,children:/*#__PURE__*/_jsx(Button,{fullWidth:true,variant:\"contained\",color:\"primary\",onClick:handleOpenContactListModal,children:i18n.t(\"contactLists.buttons.add\")})})]})})]})}),/*#__PURE__*/_jsx(Paper,{className:classes.mainPaper,variant:\"outlined\",onScroll:handleScroll,children:/*#__PURE__*/_jsxs(Table,{size:\"small\",children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:i18n.t(\"contactLists.table.name\")}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:i18n.t(\"contactLists.table.contacts\")}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:i18n.t(\"contactLists.table.actions\")})]})}),/*#__PURE__*/_jsx(TableBody,{children:/*#__PURE__*/_jsxs(_Fragment,{children:[contactLists.map(contactList=>/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:contactList.name}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:contactList.contactsCount||0}),/*#__PURE__*/_jsxs(TableCell,{align:\"center\",children:[/*#__PURE__*/_jsx(\"a\",{href:planilhaExemplo,download:\"planilha.xlsx\",children:/*#__PURE__*/_jsx(IconButton,{size:\"small\",title:\"Baixar Planilha Exemplo\",children:/*#__PURE__*/_jsx(DownloadIcon,{})})}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>goToContacts(contactList.id),children:/*#__PURE__*/_jsx(PeopleIcon,{})}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleEditContactList(contactList),children:/*#__PURE__*/_jsx(EditIcon,{})}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:e=>{setConfirmModalOpen(true);setDeletingContactList(contactList);},children:/*#__PURE__*/_jsx(DeleteOutlineIcon,{})})]})]},contactList.id)),loading&&/*#__PURE__*/_jsx(TableRowSkeleton,{columns:3})]})})]})})]});};export default ContactLists;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}