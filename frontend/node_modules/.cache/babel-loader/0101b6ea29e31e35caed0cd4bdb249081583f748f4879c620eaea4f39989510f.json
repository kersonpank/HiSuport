{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import*as Yup from\"yup\";import{Formik,Form,Field}from\"formik\";import{toast}from\"react-toastify\";import{makeStyles}from\"@material-ui/core/styles\";import{green}from\"@material-ui/core/colors\";import{Dialog,DialogContent,DialogTitle,Button,DialogActions,CircularProgress,TextField,Switch,FormControlLabel,Grid}from\"@material-ui/core\";import api from\"../../services/api\";import{i18n}from\"../../translate/i18n\";import toastError from\"../../errors/toastError\";import QueueSelect from\"../QueueSelect\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const useStyles=makeStyles(theme=>({root:{display:\"flex\",flexWrap:\"wrap\"},multFieldLine:{display:\"flex\",\"& > *:not(:last-child)\":{marginRight:theme.spacing(1)}},btnWrapper:{position:\"relative\"},buttonProgress:{color:green[500],position:\"absolute\",top:\"50%\",left:\"50%\",marginTop:-12,marginLeft:-12}}));const SessionSchema=Yup.object().shape({name:Yup.string().min(2,\"Too Short!\").max(50,\"Too Long!\").required(\"Required\")});const WhatsAppModal=_ref=>{let{open,onClose,whatsAppId}=_ref;const classes=useStyles();const initialState={name:\"\",greetingMessage:\"\",complationMessage:\"\",outOfHoursMessage:\"\",ratingMessage:\"\",isDefault:false,token:\"\",provider:\"beta\"};const[whatsApp,setWhatsApp]=useState(initialState);const[selectedQueueIds,setSelectedQueueIds]=useState([]);const[selectedQueueId,setSelectedQueueId]=useState(null);useEffect(()=>{const fetchSession=async()=>{if(!whatsAppId)return;try{var _data$queues;const{data}=await api.get(\"whatsapp/\".concat(whatsAppId,\"?session=0\"));setWhatsApp(data);const whatsQueueIds=(_data$queues=data.queues)===null||_data$queues===void 0?void 0:_data$queues.map(queue=>queue.id);setSelectedQueueIds(whatsQueueIds);setSelectedQueueId(data.transferQueueId);}catch(err){toastError(err);}};fetchSession();},[whatsAppId]);const handleSaveWhatsApp=async values=>{const whatsappData={...values,queueIds:selectedQueueIds,transferQueueId:selectedQueueId};delete whatsappData[\"queues\"];delete whatsappData[\"session\"];try{if(whatsAppId){await api.put(\"/whatsapp/\".concat(whatsAppId),whatsappData);}else{await api.post(\"/whatsapp\",whatsappData);}toast.success(i18n.t(\"whatsappModal.success\"));handleClose();}catch(err){toastError(err);}};const handleClose=()=>{onClose();setWhatsApp(initialState);setSelectedQueueId(null);setSelectedQueueIds([]);};return/*#__PURE__*/_jsx(\"div\",{className:classes.root,children:/*#__PURE__*/_jsxs(Dialog,{open:open,onClose:handleClose,maxWidth:\"sm\",fullWidth:true,scroll:\"paper\",children:[/*#__PURE__*/_jsx(DialogTitle,{children:whatsAppId?i18n.t(\"whatsappModal.title.edit\"):i18n.t(\"whatsappModal.title.add\")}),/*#__PURE__*/_jsx(Formik,{initialValues:whatsApp,enableReinitialize:true,validationSchema:SessionSchema,onSubmit:(values,actions)=>{setTimeout(()=>{handleSaveWhatsApp(values);actions.setSubmitting(false);},400);},children:_ref2=>{let{values,touched,errors,isSubmitting}=_ref2;return/*#__PURE__*/_jsxs(Form,{children:[/*#__PURE__*/_jsxs(DialogContent,{dividers:true,children:[/*#__PURE__*/_jsx(\"div\",{className:classes.multFieldLine,children:/*#__PURE__*/_jsxs(Grid,{spacing:2,container:true,children:[/*#__PURE__*/_jsx(Grid,{item:true,children:/*#__PURE__*/_jsx(Field,{as:TextField,label:i18n.t(\"whatsappModal.form.name\"),autoFocus:true,name:\"name\",error:touched.name&&Boolean(errors.name),helperText:touched.name&&errors.name,variant:\"outlined\",margin:\"dense\",className:classes.textField})}),/*#__PURE__*/_jsx(Grid,{style:{paddingTop:15},item:true,children:/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Field,{as:Switch,color:\"primary\",name:\"isDefault\",checked:values.isDefault}),label:i18n.t(\"whatsappModal.form.default\")})})]})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Field,{as:TextField,label:i18n.t(\"queueModal.form.greetingMessage\"),type:\"greetingMessage\",multiline:true,rows:4,fullWidth:true,name:\"greetingMessage\",error:touched.greetingMessage&&Boolean(errors.greetingMessage),helperText:touched.greetingMessage&&errors.greetingMessage,variant:\"outlined\",margin:\"dense\"})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Field,{as:TextField,label:i18n.t(\"queueModal.form.complationMessage\"),type:\"complationMessage\",multiline:true,rows:4,fullWidth:true,name:\"complationMessage\",error:touched.complationMessage&&Boolean(errors.complationMessage),helperText:touched.complationMessage&&errors.complationMessage,variant:\"outlined\",margin:\"dense\"})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Field,{as:TextField,label:i18n.t(\"queueModal.form.outOfHoursMessage\"),type:\"outOfHoursMessage\",multiline:true,rows:4,fullWidth:true,name:\"outOfHoursMessage\",error:touched.outOfHoursMessage&&Boolean(errors.outOfHoursMessage),helperText:touched.outOfHoursMessage&&errors.outOfHoursMessage,variant:\"outlined\",margin:\"dense\"})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Field,{as:TextField,label:i18n.t(\"queueModal.form.ratingMessage\"),type:\"ratingMessage\",multiline:true,rows:4,fullWidth:true,name:\"ratingMessage\",error:touched.ratingMessage&&Boolean(errors.ratingMessage),helperText:touched.ratingMessage&&errors.ratingMessage,variant:\"outlined\",margin:\"dense\"})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Field,{as:TextField,label:i18n.t(\"queueModal.form.token\"),type:\"token\",fullWidth:true,name:\"token\",variant:\"outlined\",margin:\"dense\"})}),/*#__PURE__*/_jsx(QueueSelect,{selectedQueueIds:selectedQueueIds,onChange:selectedIds=>setSelectedQueueIds(selectedIds)}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,children:[/*#__PURE__*/_jsx(Grid,{item:true,sm:6,children:/*#__PURE__*/_jsx(Field,{fullWidth:true,type:\"number\",as:TextField,label:\"Transferir ap\\xF3s x (minutos)\",name:\"timeToTransfer\",error:touched.timeToTransfer&&Boolean(errors.timeToTransfer),helperText:touched.timeToTransfer&&errors.timeToTransfer,variant:\"outlined\",margin:\"dense\",className:classes.textField,InputLabelProps:{shrink:values.timeToTransfer?true:false}})}),/*#__PURE__*/_jsx(Grid,{item:true,sm:6,children:/*#__PURE__*/_jsx(QueueSelect,{selectedQueueIds:selectedQueueId,onChange:selectedId=>{setSelectedQueueId(selectedId);},multiple:false,title:'Fila de TransferÃªncia'})})]})]}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:handleClose,color:\"secondary\",disabled:isSubmitting,variant:\"outlined\",children:i18n.t(\"whatsappModal.buttons.cancel\")}),/*#__PURE__*/_jsxs(Button,{type:\"submit\",color:\"primary\",disabled:isSubmitting,variant:\"contained\",className:classes.btnWrapper,children:[whatsAppId?i18n.t(\"whatsappModal.buttons.okEdit\"):i18n.t(\"whatsappModal.buttons.okAdd\"),isSubmitting&&/*#__PURE__*/_jsx(CircularProgress,{size:24,className:classes.buttonProgress})]})]})]});}})]})});};export default/*#__PURE__*/React.memo(WhatsAppModal);","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}