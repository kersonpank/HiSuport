{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import{makeStyles}from\"@material-ui/core/styles\";import Stepper from\"@material-ui/core/Stepper\";import Step from\"@material-ui/core/Step\";import StepLabel from\"@material-ui/core/StepLabel\";import Typography from\"@material-ui/core/Typography\";import{Button,IconButton,StepContent,TextField}from\"@material-ui/core\";import AddIcon from\"@material-ui/icons/Add\";import DeleteOutlineIcon from\"@material-ui/icons/DeleteOutline\";import SaveIcon from\"@material-ui/icons/Save\";import EditIcon from\"@material-ui/icons/Edit\";import api from\"../../services/api\";import toastError from\"../../errors/toastError\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const useStyles=makeStyles(theme=>({root:{width:\"100%\",//height: 400,\n[theme.breakpoints.down(\"sm\")]:{maxHeight:\"20vh\"}},button:{marginRight:theme.spacing(1)},input:{marginTop:theme.spacing(1),marginBottom:theme.spacing(1)},addButton:{marginTop:theme.spacing(2),marginBottom:theme.spacing(2)}}));export function QueueOptionStepper(_ref){let{queueId,options,updateOptions}=_ref;const classes=useStyles();const[activeOption,setActiveOption]=useState(-1);const handleOption=index=>async()=>{setActiveOption(index);const option=options[index];if(option!==undefined&&option.id!==undefined){try{const{data}=await api.request({url:\"/queue-options\",method:\"GET\",params:{queueId,parentId:option.id}});const optionList=data.map(option=>{return{...option,children:[],edition:false};});option.children=optionList;updateOptions();}catch(e){toastError(e);}}};const handleSave=async option=>{try{if(option.id){await api.request({url:\"/queue-options/\".concat(option.id),method:\"PUT\",data:option});}else{const{data}=await api.request({url:\"/queue-options\",method:\"POST\",data:option});option.id=data.id;}option.edition=false;updateOptions();}catch(e){toastError(e);}};const handleEdition=index=>{options[index].edition=!options[index].edition;updateOptions();};const handleDeleteOption=async index=>{const option=options[index];if(option!==undefined&&option.id!==undefined){try{await api.request({url:\"/queue-options/\".concat(option.id),method:\"DELETE\"});}catch(e){toastError(e);}}options.splice(index,1);options.forEach(async(option,order)=>{option.option=order+1;await handleSave(option);});updateOptions();};const handleOptionChangeTitle=(event,index)=>{options[index].title=event.target.value;updateOptions();};const handleOptionChangeMessage=(event,index)=>{options[index].message=event.target.value;updateOptions();};const renderTitle=index=>{const option=options[index];if(option.edition){return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(TextField,{value:option.title,onChange:event=>handleOptionChangeTitle(event,index),size:\"small\",className:classes.input,placeholder:\"T\\xEDtulo da op\\xE7\\xE3o\"}),option.edition&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(IconButton,{color:\"primary\",variant:\"outlined\",size:\"small\",className:classes.button,onClick:()=>handleSave(option),children:/*#__PURE__*/_jsx(SaveIcon,{})}),/*#__PURE__*/_jsx(IconButton,{variant:\"outlined\",color:\"secondary\",size:\"small\",className:classes.button,onClick:()=>handleDeleteOption(index),children:/*#__PURE__*/_jsx(DeleteOutlineIcon,{})})]})]});}return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(Typography,{children:[option.title!==\"\"?option.title:\"Título não definido\",/*#__PURE__*/_jsx(IconButton,{variant:\"outlined\",size:\"small\",className:classes.button,onClick:()=>handleEdition(index),children:/*#__PURE__*/_jsx(EditIcon,{})})]})});};const renderMessage=index=>{const option=options[index];if(option.edition){return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(TextField,{style:{width:\"100%\"},multiline:true,value:option.message,onChange:event=>handleOptionChangeMessage(event,index),size:\"small\",className:classes.input,placeholder:\"Digite o texto da op\\xE7\\xE3o\"})});}return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(Typography,{onClick:()=>handleEdition(index),children:option.message})});};const handleAddOption=index=>{const optionNumber=options[index].children.length+1;options[index].children.push({title:\"\",message:\"\",edition:false,option:optionNumber,queueId,parentId:options[index].id,children:[]});updateOptions();};const renderStep=(option,index)=>{return/*#__PURE__*/_jsxs(Step,{children:[/*#__PURE__*/_jsx(StepLabel,{style:{cursor:\"pointer\"},onClick:handleOption(index),children:renderTitle(index)}),/*#__PURE__*/_jsxs(StepContent,{children:[renderMessage(index),option.id!==undefined&&/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(Button,{color:\"primary\",size:\"small\",onClick:()=>handleAddOption(index),startIcon:/*#__PURE__*/_jsx(AddIcon,{}),variant:\"outlined\",className:classes.addButton,children:\"Adicionar\"})}),/*#__PURE__*/_jsx(QueueOptionStepper,{queueId:queueId,options:option.children,updateOptions:updateOptions})]})]},index);};const renderStepper=()=>{return/*#__PURE__*/_jsx(Stepper,{style:{marginBottom:0,paddingBottom:0},nonLinear:true,activeStep:activeOption,orientation:\"vertical\",children:options.map((option,index)=>renderStep(option,index))});};return renderStepper();}export function QueueOptions(_ref2){let{queueId}=_ref2;const classes=useStyles();const[options,setOptions]=useState([]);useEffect(()=>{if(queueId){const fetchOptions=async()=>{try{const{data}=await api.request({url:\"/queue-options\",method:\"GET\",params:{queueId,parentId:-1}});const optionList=data.map(option=>{return{...option,children:[],edition:false};});setOptions(optionList);}catch(e){toastError(e);}};fetchOptions();}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);const renderStepper=()=>{if(options.length>0){return/*#__PURE__*/_jsx(QueueOptionStepper,{queueId:queueId,updateOptions:updateOptions,options:options});}};const updateOptions=()=>{setOptions([...options]);};const addOption=()=>{const newOption={title:\"\",message:\"\",edition:false,option:options.length+1,queueId,parentId:null,children:[]};setOptions([...options,newOption]);};return/*#__PURE__*/_jsxs(\"div\",{className:classes.root,children:[/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(Typography,{children:[\"Op\\xE7\\xF5es\",/*#__PURE__*/_jsx(Button,{color:\"primary\",size:\"small\",onClick:addOption,startIcon:/*#__PURE__*/_jsx(AddIcon,{}),style:{marginLeft:10},variant:\"outlined\",children:\"Adicionar\"})]}),renderStepper()]});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}