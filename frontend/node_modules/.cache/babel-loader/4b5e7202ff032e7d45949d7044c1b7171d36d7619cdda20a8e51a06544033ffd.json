{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{makeStyles}from\"@material-ui/core/styles\";import Paper from\"@material-ui/core/Paper\";import{toast}from\"react-toastify\";import MainContainer from\"../../components/MainContainer\";import MainHeader from\"../../components/MainHeader\";import Title from\"../../components/Title\";import DeleteOutlineIcon from\"@material-ui/icons/DeleteOutline\";import api from\"../../services/api\";import{i18n}from\"../../translate/i18n\";import{Box,Button,FormControl,Grid,IconButton,InputLabel,MenuItem,Select,Table,TableBody,TableCell,TableHead,TableRow,TextField,Typography}from\"@material-ui/core\";import ConfirmationModal from\"../../components/ConfirmationModal\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const useStyles=makeStyles(theme=>({mainPaper:{flex:1,padding:theme.spacing(1),overflowY:\"scroll\",...theme.scrollbarStyles},textRight:{textAlign:\"right\"},tabPanelsContainer:{padding:theme.spacing(2)}}));const initialSettings={messageInterval:20,longerIntervalAfter:20,greaterInterval:60,variables:[]};const CampaignsConfig=()=>{const classes=useStyles();const[settings,setSettings]=useState(initialSettings);const[showVariablesForm,setShowVariablesForm]=useState(false);const[confirmationOpen,setConfirmationOpen]=useState(false);const[selectedKey,setSelectedKey]=useState(null);const[variable,setVariable]=useState({key:\"\",value:\"\"});useEffect(()=>{api.get(\"/campaign-settings\").then(_ref=>{let{data}=_ref;const settingsList=[];if(Array.isArray(data)&&data.length>0){data.forEach(item=>{settingsList.push([item.key,JSON.parse(item.value)]);});setSettings(Object.fromEntries(settingsList));}});},[]);const handleOnChangeVariable=e=>{if(e.target.value!==null){const changedProp={};changedProp[e.target.name]=e.target.value;setVariable(prev=>({...prev,...changedProp}));}};const handleOnChangeSettings=e=>{const changedProp={};changedProp[e.target.name]=e.target.value;setSettings(prev=>({...prev,...changedProp}));};const addVariable=()=>{setSettings(prev=>{const variablesExists=settings.variables.filter(v=>v.key===variable.key);const variables=prev.variables;if(variablesExists.length===0){variables.push(Object.assign({},variable));setVariable({key:\"\",value:\"\"});}return{...prev,variables};});};const removeVariable=()=>{const newList=settings.variables.filter(v=>v.key!==selectedKey);setSettings(prev=>({...prev,variables:newList}));setSelectedKey(null);};const saveSettings=async()=>{await api.post(\"/campaign-settings\",{settings});toast.success(\"Configurações salvas\");};return/*#__PURE__*/_jsxs(MainContainer,{children:[/*#__PURE__*/_jsx(ConfirmationModal,{title:i18n.t(\"campaigns.confirmationModal.deleteTitle\"),open:confirmationOpen,onClose:()=>setConfirmationOpen(false),onConfirm:removeVariable,children:i18n.t(\"campaigns.confirmationModal.deleteMessage\")}),/*#__PURE__*/_jsx(MainHeader,{children:/*#__PURE__*/_jsx(Grid,{style:{width:\"99.6%\"},container:true,children:/*#__PURE__*/_jsx(Grid,{xs:12,item:true,children:/*#__PURE__*/_jsx(Title,{children:i18n.t(\"campaignsConfig.title\")})})})}),/*#__PURE__*/_jsx(Paper,{className:classes.mainPaper,variant:\"outlined\",children:/*#__PURE__*/_jsx(Box,{className:classes.tabPanelsContainer,children:/*#__PURE__*/_jsxs(Grid,{spacing:2,container:true,children:[/*#__PURE__*/_jsx(Grid,{xs:12,item:true,children:/*#__PURE__*/_jsx(Typography,{component:\"h3\",children:\"Intervalos\"})}),/*#__PURE__*/_jsx(Grid,{xs:12,md:4,item:true,children:/*#__PURE__*/_jsxs(FormControl,{variant:\"outlined\",className:classes.formControl,fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{id:\"messageInterval-label\",children:\"Intervalo Rand\\xF4mico de Disparo\"}),/*#__PURE__*/_jsxs(Select,{name:\"messageInterval\",id:\"messageInterval\",labelId:\"messageInterval-label\",label:\"Intervalo Rand\\xF4mico de Disparo\",value:settings.messageInterval,onChange:e=>handleOnChangeSettings(e),children:[/*#__PURE__*/_jsx(MenuItem,{value:0,children:\"Sem Intervalo\"}),/*#__PURE__*/_jsx(MenuItem,{value:5,children:\"5 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:10,children:\"10 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:15,children:\"15 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:20,children:\"20 segundos\"})]})]})}),/*#__PURE__*/_jsx(Grid,{xs:12,md:4,item:true,children:/*#__PURE__*/_jsxs(FormControl,{variant:\"outlined\",className:classes.formControl,fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{id:\"longerIntervalAfter-label\",children:\"Intervalo Maior Ap\\xF3s\"}),/*#__PURE__*/_jsxs(Select,{name:\"longerIntervalAfter\",id:\"longerIntervalAfter\",labelId:\"longerIntervalAfter-label\",label:\"Intervalo Maior Ap\\xF3s\",value:settings.longerIntervalAfter,onChange:e=>handleOnChangeSettings(e),children:[/*#__PURE__*/_jsx(MenuItem,{value:0,children:\"N\\xE3o definido\"}),/*#__PURE__*/_jsx(MenuItem,{value:5,children:\"5 mensagens\"}),/*#__PURE__*/_jsx(MenuItem,{value:10,children:\"10 mensagens\"}),/*#__PURE__*/_jsx(MenuItem,{value:15,children:\"15 mensagens\"}),/*#__PURE__*/_jsx(MenuItem,{value:20,children:\"20 mensagens\"})]})]})}),/*#__PURE__*/_jsx(Grid,{xs:12,md:4,item:true,children:/*#__PURE__*/_jsxs(FormControl,{variant:\"outlined\",className:classes.formControl,fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{id:\"greaterInterval-label\",children:\"Intervalo de Disparo Maior\"}),/*#__PURE__*/_jsxs(Select,{name:\"greaterInterval\",id:\"greaterInterval\",labelId:\"greaterInterval-label\",label:\"Intervalo de Disparo Maior\",value:settings.greaterInterval,onChange:e=>handleOnChangeSettings(e),children:[/*#__PURE__*/_jsx(MenuItem,{value:0,children:\"Sem Intervalo\"}),/*#__PURE__*/_jsx(MenuItem,{value:20,children:\"20 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:30,children:\"30 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:40,children:\"40 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:50,children:\"50 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:60,children:\"60 segundos\"})]})]})}),/*#__PURE__*/_jsxs(Grid,{xs:12,className:classes.textRight,item:true,children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setShowVariablesForm(!showVariablesForm),color:\"primary\",style:{marginRight:10},children:\"Adicionar Vari\\xE1vel\"}),/*#__PURE__*/_jsx(Button,{onClick:saveSettings,color:\"primary\",variant:\"contained\",children:\"Salvar Configura\\xE7\\xF5es\"})]}),showVariablesForm&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Grid,{xs:12,md:6,item:true,children:/*#__PURE__*/_jsx(TextField,{label:\"Atalho\",variant:\"outlined\",value:variable.key,name:\"key\",onChange:handleOnChangeVariable,fullWidth:true})}),/*#__PURE__*/_jsx(Grid,{xs:12,md:6,item:true,children:/*#__PURE__*/_jsx(TextField,{label:\"Conte\\xFAdo\",variant:\"outlined\",value:variable.value,name:\"value\",onChange:handleOnChangeVariable,fullWidth:true})}),/*#__PURE__*/_jsxs(Grid,{xs:12,className:classes.textRight,item:true,children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setShowVariablesForm(!showVariablesForm),color:\"primary\",style:{marginRight:10},children:\"Fechar\"}),/*#__PURE__*/_jsx(Button,{onClick:addVariable,color:\"primary\",variant:\"contained\",children:\"Adicionar\"})]})]}),settings.variables.length>0&&/*#__PURE__*/_jsx(Grid,{xs:12,className:classes.textRight,item:true,children:/*#__PURE__*/_jsxs(Table,{size:\"small\",children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{style:{width:\"1%\"}}),/*#__PURE__*/_jsx(TableCell,{children:\"Atalho\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Conte\\xFAdo\"})]})}),/*#__PURE__*/_jsx(TableBody,{children:Array.isArray(settings.variables)&&settings.variables.map((v,k)=>/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>{setSelectedKey(v.key);setConfirmationOpen(true);},children:/*#__PURE__*/_jsx(DeleteOutlineIcon,{})})}),/*#__PURE__*/_jsx(TableCell,{children:\"{\"+v.key+\"}\"}),/*#__PURE__*/_jsx(TableCell,{children:v.value})]},k))})]})})]})})})]});};export default CampaignsConfig;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}