{"ast":null,"code":"import React,{useState,useEffect,useRef,useContext}from\"react\";import{useHistory,useParams}from\"react-router-dom\";import{parseISO,format,isSameDay}from\"date-fns\";import clsx from\"clsx\";import{makeStyles}from\"@material-ui/core/styles\";import{green}from\"@material-ui/core/colors\";import ListItem from\"@material-ui/core/ListItem\";import ListItemText from\"@material-ui/core/ListItemText\";import ListItemAvatar from\"@material-ui/core/ListItemAvatar\";import Typography from\"@material-ui/core/Typography\";import Avatar from\"@material-ui/core/Avatar\";import Divider from\"@material-ui/core/Divider\";import Badge from\"@material-ui/core/Badge\";import{i18n}from\"../../translate/i18n\";import api from\"../../services/api\";import ButtonWithSpinner from\"../ButtonWithSpinner\";import MarkdownWrapper from\"../MarkdownWrapper\";import{Tooltip}from\"@material-ui/core\";import{AuthContext}from\"../../context/Auth/AuthContext\";import toastError from\"../../errors/toastError\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const useStyles=makeStyles(theme=>({ticket:{position:\"relative\"},pendingTicket:{cursor:\"unset\"},noTicketsDiv:{display:\"flex\",height:\"100px\",margin:40,flexDirection:\"column\",alignItems:\"center\",justifyContent:\"center\"},noTicketsText:{textAlign:\"center\",color:\"rgb(104, 121, 146)\",fontSize:\"14px\",lineHeight:\"1.4\"},noTicketsTitle:{textAlign:\"center\",fontSize:\"16px\",fontWeight:\"600\",margin:\"0px\"},contactNameWrapper:{display:\"flex\",justifyContent:\"space-between\"},lastMessageTime:{justifySelf:\"flex-end\"},closedBadge:{alignSelf:\"center\",justifySelf:\"flex-end\",marginRight:32,marginLeft:\"auto\"},contactLastMessage:{paddingRight:20},newMessagesCount:{alignSelf:\"center\",marginRight:8,marginLeft:\"auto\"},badgeStyle:{color:\"white\",backgroundColor:green[500]},acceptButton:{position:\"absolute\",left:\"50%\"},ticketQueueColor:{flex:\"none\",width:\"8px\",height:\"100%\",position:\"absolute\",top:\"0%\",left:\"0%\"}}));const TicketListItem=_ref=>{var _ticket$queue,_ticket$queue2,_ticket$contact;let{ticket}=_ref;const classes=useStyles();const history=useHistory();const[loading,setLoading]=useState(false);const{ticketId}=useParams();const isMounted=useRef(true);const{user}=useContext(AuthContext);useEffect(()=>{return()=>{isMounted.current=false;};},[]);const handleAcepptTicket=async ticket=>{setLoading(true);try{await api.put(\"/tickets/\".concat(ticket.id),{status:\"open\",userId:user===null||user===void 0?void 0:user.id});}catch(err){setLoading(false);toastError(err);}if(isMounted.current){setLoading(false);}history.push(\"/tickets/\".concat(ticket.uuid));};console.log(\"ðŸš€ Console Log : ticket.lastMessage\",ticket.lastMessage);const handleSelectTicket=ticket=>{history.push(\"/tickets/\".concat(ticket.uuid));};return/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsxs(ListItem,{dense:true,button:true,onClick:e=>{if(ticket.status===\"pending\")return;handleSelectTicket(ticket);},selected:ticketId&&+ticketId===ticket.id,className:clsx(classes.ticket,{[classes.pendingTicket]:ticket.status===\"pending\"}),children:[/*#__PURE__*/_jsx(Tooltip,{arrow:true,placement:\"right\",title:((_ticket$queue=ticket.queue)===null||_ticket$queue===void 0?void 0:_ticket$queue.name)||\"Sem fila\",children:/*#__PURE__*/_jsx(\"span\",{style:{backgroundColor:((_ticket$queue2=ticket.queue)===null||_ticket$queue2===void 0?void 0:_ticket$queue2.color)||\"#7C7C7C\"},className:classes.ticketQueueColor})}),/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{src:ticket===null||ticket===void 0?void 0:(_ticket$contact=ticket.contact)===null||_ticket$contact===void 0?void 0:_ticket$contact.profilePicUrl})}),/*#__PURE__*/_jsx(ListItemText,{disableTypography:true,primary:/*#__PURE__*/_jsxs(\"span\",{className:classes.contactNameWrapper,children:[/*#__PURE__*/_jsx(Typography,{noWrap:true,component:\"span\",variant:\"body2\",color:\"textPrimary\",children:ticket.contact.name}),ticket.status===\"closed\"&&/*#__PURE__*/_jsx(Badge,{className:classes.closedBadge,badgeContent:\"closed\",color:\"primary\"})]})/*           secondary={\n            <span className={classes.contactNameWrapper}>\n              <Typography\n                className={classes.contactLastMessage}\n                noWrap\n                component=\"span\"\n                variant=\"body2\"\n                color=\"textSecondary\"\n              >\n                {ticket.lastMessage ? (\n                  <MarkdownWrapper>{ticket.lastMessage}</MarkdownWrapper>\n                ) : (\n                  <MarkdownWrapper></MarkdownWrapper>\n                )}\n              </Typography>\n\n              <Badge\n                className={classes.newMessagesCount}\n                badgeContent={ticket.unreadMessages}\n                classes={{\n                  badge: classes.badgeStyle,\n                }}\n              />\n            </span>\n          } */}),ticket.status===\"pending\"&&/*#__PURE__*/_jsx(ButtonWithSpinner,{color:\"primary\",variant:\"contained\",className:classes.acceptButton,size:\"small\",loading:loading,onClick:e=>handleAcepptTicket(ticket),children:i18n.t(\"ticketsList.buttons.accept\")})]}),/*#__PURE__*/_jsx(Divider,{variant:\"inset\",component:\"li\"})]},ticket.id);};export default TicketListItem;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}