{"ast":null,"code":"import React,{useEffect,useReducer,useState}from\"react\";import{Button,IconButton,makeStyles,Paper,Table,TableBody,TableCell,TableHead,TableRow,Typography}from\"@material-ui/core\";import MainContainer from\"../../components/MainContainer\";import MainHeader from\"../../components/MainHeader\";import MainHeaderButtonsWrapper from\"../../components/MainHeaderButtonsWrapper\";import TableRowSkeleton from\"../../components/TableRowSkeleton\";import Title from\"../../components/Title\";import{i18n}from\"../../translate/i18n\";import toastError from\"../../errors/toastError\";import api from\"../../services/api\";import{DeleteOutline,Edit}from\"@material-ui/icons\";import QueueModal from\"../../components/QueueModal\";import{toast}from\"react-toastify\";import ConfirmationModal from\"../../components/ConfirmationModal\";import{socketConnection}from\"../../services/socket\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const useStyles=makeStyles(theme=>({mainPaper:{flex:1,padding:theme.spacing(1),overflowY:\"scroll\",...theme.scrollbarStyles},customTableCell:{display:\"flex\",alignItems:\"center\",justifyContent:\"center\"}}));const reducer=(state,action)=>{if(action.type===\"LOAD_QUEUES\"){const queues=action.payload;const newQueues=[];queues.forEach(queue=>{const queueIndex=state.findIndex(q=>q.id===queue.id);if(queueIndex!==-1){state[queueIndex]=queue;}else{newQueues.push(queue);}});return[...state,...newQueues];}if(action.type===\"UPDATE_QUEUES\"){const queue=action.payload;const queueIndex=state.findIndex(u=>u.id===queue.id);if(queueIndex!==-1){state[queueIndex]=queue;return[...state];}else{return[queue,...state];}}if(action.type===\"DELETE_QUEUE\"){const queueId=action.payload;const queueIndex=state.findIndex(q=>q.id===queueId);if(queueIndex!==-1){state.splice(queueIndex,1);}return[...state];}if(action.type===\"RESET\"){return[];}};const Queues=()=>{const classes=useStyles();const[queues,dispatch]=useReducer(reducer,[]);const[loading,setLoading]=useState(false);const[queueModalOpen,setQueueModalOpen]=useState(false);const[selectedQueue,setSelectedQueue]=useState(null);const[confirmModalOpen,setConfirmModalOpen]=useState(false);useEffect(()=>{(async()=>{setLoading(true);try{const{data}=await api.get(\"/queue\");dispatch({type:\"LOAD_QUEUES\",payload:data});setLoading(false);}catch(err){toastError(err);setLoading(false);}})();},[]);useEffect(()=>{const companyId=localStorage.getItem(\"companyId\");const socket=socketConnection({companyId});socket.on(\"company-\".concat(companyId,\"-queue\"),data=>{if(data.action===\"update\"||data.action===\"create\"){dispatch({type:\"UPDATE_QUEUES\",payload:data.queue});}if(data.action===\"delete\"){dispatch({type:\"DELETE_QUEUE\",payload:data.queueId});}});return()=>{socket.disconnect();};},[]);const handleOpenQueueModal=()=>{setQueueModalOpen(true);setSelectedQueue(null);};const handleCloseQueueModal=()=>{setQueueModalOpen(false);setSelectedQueue(null);};const handleEditQueue=queue=>{setSelectedQueue(queue);setQueueModalOpen(true);};const handleCloseConfirmationModal=()=>{setConfirmModalOpen(false);setSelectedQueue(null);};const handleDeleteQueue=async queueId=>{try{await api.delete(\"/queue/\".concat(queueId));toast.success(i18n.t(\"Queue deleted successfully!\"));}catch(err){toastError(err);}setSelectedQueue(null);};return/*#__PURE__*/_jsxs(MainContainer,{children:[/*#__PURE__*/_jsx(ConfirmationModal,{title:selectedQueue&&\"\".concat(i18n.t(\"queues.confirmationModal.deleteTitle\"),\" \").concat(selectedQueue.name,\"?\"),open:confirmModalOpen,onClose:handleCloseConfirmationModal,onConfirm:()=>handleDeleteQueue(selectedQueue.id),children:i18n.t(\"queues.confirmationModal.deleteMessage\")}),/*#__PURE__*/_jsx(QueueModal,{open:queueModalOpen,onClose:handleCloseQueueModal,queueId:selectedQueue===null||selectedQueue===void 0?void 0:selectedQueue.id}),/*#__PURE__*/_jsxs(MainHeader,{children:[/*#__PURE__*/_jsx(Title,{children:i18n.t(\"queues.title\")}),/*#__PURE__*/_jsx(MainHeaderButtonsWrapper,{children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",onClick:handleOpenQueueModal,children:i18n.t(\"queues.buttons.add\")})})]}),/*#__PURE__*/_jsx(Paper,{className:classes.mainPaper,variant:\"outlined\",children:/*#__PURE__*/_jsxs(Table,{size:\"small\",children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:i18n.t(\"queues.table.name\")}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:i18n.t(\"queues.table.color\")}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:i18n.t(\"queues.table.greeting\")}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:i18n.t(\"queues.table.actions\")})]})}),/*#__PURE__*/_jsx(TableBody,{children:/*#__PURE__*/_jsxs(_Fragment,{children:[queues.map(queue=>/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:queue.name}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:/*#__PURE__*/_jsx(\"div\",{className:classes.customTableCell,children:/*#__PURE__*/_jsx(\"span\",{style:{backgroundColor:queue.color,width:60,height:20,alignSelf:\"center\"}})})}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:/*#__PURE__*/_jsx(\"div\",{className:classes.customTableCell,children:/*#__PURE__*/_jsx(Typography,{style:{width:300,align:\"center\"},noWrap:true,variant:\"body2\",children:queue.greetingMessage})})}),/*#__PURE__*/_jsxs(TableCell,{align:\"center\",children:[/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleEditQueue(queue),children:/*#__PURE__*/_jsx(Edit,{})}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>{setSelectedQueue(queue);setConfirmModalOpen(true);},children:/*#__PURE__*/_jsx(DeleteOutline,{})})]})]},queue.id)),loading&&/*#__PURE__*/_jsx(TableRowSkeleton,{columns:4})]})})]})})]});};export default Queues;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}